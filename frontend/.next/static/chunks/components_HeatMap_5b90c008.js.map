{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://A%3A/IIST%20GEO%20INFORMATICS/2nd%20SEMESTER/IEEE%20GRSS/PS-4/proj1/frontend/components/HeatMap.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { MapContainer, TileLayer, useMap, Marker, Popup } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport 'leaflet.heat';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\n// Fix for default marker icons in Leaflet\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: '/leaflet/images/marker-icon-2x.png',\r\n  iconUrl: '/leaflet/images/marker-icon.png',\r\n  shadowUrl: '/leaflet/images/marker-shadow.png',\r\n});\r\n\r\n// Heatmap layer component\r\nconst HeatmapLayer = ({ data }) => {\r\n  const map = useMap();\r\n  const [heatLayer, setHeatLayer] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (!data || data.length === 0) return;\r\n\r\n    // Convert data to heatmap format [lat, lng, intensity]\r\n    const heatmapData = data\r\n      .filter(item => item.lat && item.lon && item.pm25)\r\n      .map(item => [\r\n        parseFloat(item.lat),\r\n        parseFloat(item.lon),\r\n        parseFloat(item.pm25) / 10 // Normalize intensity\r\n      ]);\r\n\r\n    if (heatmapData.length === 0) return;\r\n\r\n    // Remove previous heat layer if exists\r\n    if (heatLayer) {\r\n      map.removeLayer(heatLayer);\r\n    }\r\n\r\n    // Create new heat layer with current data\r\n    const newHeatLayer = L.heatLayer(heatmapData, {\r\n      radius: 25,\r\n      blur: 15,\r\n      maxZoom: 17,\r\n      minOpacity: 0.5,\r\n      gradient: {\r\n        0.4: 'blue',\r\n        0.6: 'cyan',\r\n        0.7: 'lime',\r\n        0.8: 'yellow',\r\n        1.0: 'red'\r\n      }\r\n    }).addTo(map);\r\n\r\n    setHeatLayer(newHeatLayer);\r\n\r\n    // Fit map to heatmap bounds\r\n    const bounds = L.latLngBounds(heatmapData.map(item => [item[0], item[1]]));\r\n    map.fitBounds(bounds, { padding: [50, 50] });\r\n\r\n  }, [data, map]);\r\n\r\n  return null;\r\n};\r\n\r\n// Data point markers component\r\nconst DataMarkers = ({ data }) => {\r\n  return (\r\n    <>\r\n      {data.map((item, index) => (\r\n        <Marker \r\n          key={index} \r\n          position={[parseFloat(item.lat), parseFloat(item.lon)]}\r\n        >\r\n          <Popup>\r\n            <div>\r\n              <strong>PM2.5:</strong> {item.pm25} µg/m³<br />\r\n              <strong>Temperature:</strong> {item.temp}°C<br />\r\n              <strong>Humidity:</strong> {item.humidity}%<br />\r\n              <strong>Wind:</strong> {item.wind} km/h<br />\r\n              <small>{item.date} {item.time}</small>\r\n            </div>\r\n          </Popup>\r\n        </Marker>\r\n      ))}\r\n    </>\r\n  );\r\n};\r\n\r\n// Main heatmap component\r\nconst Heatmap = ({ data }) => {\r\n  const [mapData, setMapData] = useState([]);\r\n\r\n  // Process data when received\r\n  useEffect(() => {\r\n    if (data && data.length > 0) {\r\n      const processed = data.map(item => ({\r\n        ...item,\r\n        lat: parseFloat(item.lat),\r\n        lon: parseFloat(item.lon),\r\n        pm25: parseFloat(item.pm25),\r\n        temp: parseFloat(item.temp),\r\n        humidity: parseFloat(item.humidity),\r\n        wind: parseFloat(item.wind)\r\n      }));\r\n      setMapData(processed);\r\n    }\r\n  }, [data]);\r\n\r\n  // Calculate center point from data\r\n  const center = mapData.length > 0 \r\n    ? [mapData[0].lat, mapData[0].lon]\r\n    : [28.6139, 77.2090]; // Default to New Delhi coordinates\r\n\r\n  return (\r\n    <div style={{ height: '500px', width: '100%', borderRadius: '8px', overflow: 'hidden' }}>\r\n      <MapContainer \r\n        center={center} \r\n        zoom={12} \r\n        style={{ height: '100%', width: '100%' }}\r\n        scrollWheelZoom={true}\r\n      >\r\n        <TileLayer\r\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n        />\r\n        <HeatmapLayer data={mapData} />\r\n        <DataMarkers data={mapData} />\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Heatmap;"],"names":[],"mappings":"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","debugId":null}}]
}